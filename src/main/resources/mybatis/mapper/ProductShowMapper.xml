<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xzy.mapper.ProductShowMapper">

    <resultMap id="queryProduct" type="com.xzy.beans.ProductShow">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.hy
        -->
        <id column="product_id" property="productId" jdbcType="INTEGER"/>
        <result column="product_name" property="productName" jdbcType="VARCHAR"/>
        <result column="product_picture" property="productPicture" jdbcType="VARCHAR"/>
        <result column="product_stock" property="productStock" jdbcType="INTEGER"/>
        <result column="product_com_num" property="productComNum" jdbcType="INTEGER"/>
        <result column="product_price" property="productPrice" jdbcType="REAL"/>
        <result column="product_describe" property="productDescribe" jdbcType="VARCHAR"/>
        <result column="product_size_pic" property="productSizePic" jdbcType="VARCHAR"/>
        <result column="product_superclass" property="productSuperclass" jdbcType="CHAR"/>
        <result column="product_class_id" property="productClassId" jdbcType="VARCHAR"/>
        <result column="product_createtime" property="productCreatetime" jdbcType="TIMESTAMP"/>
        <result column="product_brand" property="productBrand" jdbcType="VARCHAR"/>
        <result column="product_material" property="productMaterial" jdbcType="VARCHAR"/>
        <result column="product_version" property="productVersion" jdbcType="VARCHAR"/>
        <result column="product_style" property="productStyle" jdbcType="VARCHAR"/>
        <result column="product_thickness" property="productThickness" jdbcType="VARCHAR"/>
        <collection property="productColors" ofType="com.xzy.beans.ProductColor">
            <result column="color" property="color" jdbcType="VARCHAR"/>
        </collection>
        <collection property="productSizes" ofType="com.xzy.beans.ProductSize">
            <result column="size" property="size" jdbcType="VARCHAR"/>
        </collection>

        <collection property="carousel" ofType="com.xzy.beans.Carousel">
            <result column="path" property="path" jdbcType="VARCHAR"/>
        </collection>
        <collection property="productDiscuss" ofType="com.xzy.beans.ProductDiscuss">
            <result column="produc_discuss_comment" property="producDiscussComment" jdbcType="VARCHAR"/>
            <result column="pd_createtime" property="pdCreatetime" jdbcType="DATE"/>
            <association property="user" javaType="com.xzy.beans.User">
                <result column="user_name" property="userName" jdbcType="VARCHAR"/>
            </association>
        </collection>
    </resultMap>
    <select resultMap="queryProduct" id="selectAllByProductId">
        SELECT p.*,`color`,`size`,`path`,produc_discuss_comment,pd_createtime,user_name
  FROM (product p ,`user`  u )
  LEFT JOIN product_size ps ON (ps.`product_id`=p.`product_id`)
  LEFT JOIN product_color pc ON (pc.`product_id`=p.`product_id`)
  LEFT JOIN product_discuss pdi ON (pdi.`product_id`=p.`product_id`)
  LEFT JOIN carousel c ON (c.`product_id`=p.`product_id`)
  WHERE  p.`product_id` = #{productId}
</select>
    <!--根据商品id查询用户浏览记录表-->
    <resultMap id="userHistory" type="com.xzy.beans.Browse">
        <id column="browse_id" property="browseId"/>
        <result column="browse_time" property="browseTime"/>
        <result column="user_id" property="userId"/>
        <result column="product_id" property="productId"/>
    </resultMap>
    <!--更新用户历史记录表-->
    <update id="updateHistory" parameterType="com.xzy.beans.Browse">
        UPDATE browse SET browse_time=#{browseTime} WHERE user_id=#{userId} AND product_id=#{productId}
    </update>
    <!--将商品插入浏览历史表-->
    <insert id="insertHistory" parameterType="com.xzy.beans.Browse">
        INSERT INTO browse (browse_time,user_id,product_id) VALUES (#{browseTime},#{userId},#{productId})
    </insert>
    <!--根据用户id查询浏览记录-->
    <select id="selectHistoryByUserId" parameterType="Integer" resultMap="userHistory">
        SELECT b.* FROM browse b
         WHERE  user_id=#{userId} order by browse_time desc
    </select>
    <!--根据用户id和商品id查询浏览记录-->
    <select id="selectHistoryByUserIdAndProductId" parameterType="com.xzy.beans.Browse" resultMap="userHistory">
        SELECT b.* FROM browse b WHERE  user_id=#{userId} AND product_id=#{productId}
    </select>
    <!--删除一条浏览记录-->
    <delete id="deleteHistory">
        delete from browse where product_id=#{productId} and user_id = #{userId}
    </delete>
</mapper>